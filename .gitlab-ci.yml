# The image used in the jobs is generated from the Dockerfile available here:
# https://ci.linagora.com/linagora/lgs/openpaas/ci/blob/master/Dockerfile

stages:
  - linter
  - build
  - test
  - publish

variables:
  LC_ALL: "en_US.UTF-8"
  LANG: "en_US.UTF-8"

lintDebug:
  image: docker-registry.linagora.com:5000/lgs-sandbox/fastlane-android-29
  stage: linter
  tags:
    - docker
  script:
    - bundle exec fastlane lintDebug

ktlint:
  image: docker-registry.linagora.com:5000/lgs-sandbox/fastlane-android-29
  stage: linter
  tags:
    - docker
  script:
    - bundle exec fastlane ktlint

assembleDebug:
  image: docker-registry.linagora.com:5000/lgs-sandbox/fastlane-android-29
  stage: build
  tags:
    - docker
  script:
    - bundle exec fastlane assembleDebug

testDebug:
  image: docker-registry.linagora.com:5000/lgs-sandbox/fastlane-android-29
  stage: test
  tags:
    - docker
  script:
    - bundle exec fastlane testDebug

publishAPK:
  image: docker-registry.linagora.com:5000/lgs-sandbox/fastlane-android-29
  stage: publish
  tags:
    - docker
  script:
    - bundle exec fastlane assemble
  environment:
    name: master
  artifacts:
    name: "linshare-apk-for-test"
    expire_in: 1 month
    paths:
      - presentation/build/outputs/apk/develop/LinShare*.apk
  only:
    - master